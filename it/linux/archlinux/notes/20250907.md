# Archlinux 的安装和使用
## 安装
参考：
- [Arch Linux 完全安装教程 2025.1](https://www.bilibili.com/read/cv20753052)
- 
### 引导盘
- 下载最新的 [ISO](https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/)，比如 [archlinux-x86_64.iso](https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/latest/archlinux-x86_64.iso)
- 下载 [ventory](https://www.ventoy.net/cn/index.html) 制作 USB 引导盘
### 开始安装
1. 选择 USB 盘启动，待加载完毕后可以拔出 USB
2. 硬盘分区（双系统）   
   查看硬盘：`fdisk -l`
   ```
   Disk /dev/nvme0n1：476.94 GiB，512110190592 字节，1000215216 个扇区
   磁盘型号：Micron MTFDHBA512TDV                    
   单元：扇区 / 1 * 512 = 512 字节
   扇区大小(逻辑/物理)：512 字节 / 512 字节
   I/O 大小(最小/最佳)：512 字节 / 512 字节
   磁盘标签类型：gpt
   磁盘标识符：AE0899EB-02C4-4D61-AE8E-8C7EA4556BCE
   
   设备                起点       末尾      扇区   大小 类型
   /dev/nvme0n1p1      2048     534527    532480   260M EFI 系统
   /dev/nvme0n1p2    534528     567295     32768    16M Microsoft 保留
   /dev/nvme0n1p3    567296  170139647 169572352  80.9G Microsoft 基本数据
   /dev/nvme0n1p4 170139648  419995647 249856000 119.1G Microsoft 基本数据
   /dev/nvme0n1p5 419997696  735959039 315961344 150.7G Microsoft 基本数据
   /dev/nvme0n1p6 735959040  773707775  37748736    18G Linux swap
   /dev/nvme0n1p7 773707776 1000214527 226506752   108G Linux root (x86-64)
   ```
   
   通过 `cfdisk <硬盘编号>` 进行分区，比如 `cfdisk /dev/nvme0n1`。
   
   格式化：
   ```sh
   系统分区：
   
   # mkfs.ext4 <分区编号>
   
   交换分区（如果有）：
   
   # mkswap <分区编号>
   
   启动交换分区（如果有）：
   
   # swapon <分区编号>
   
   挂载即将安装系统的分区：
   
   # mount <分区编号> /mnt
   
   # mount /mnt/boot/efi
   # mount <EFI分区编号> /mnt/boot/efi
   
   
   EFI 分区（不执行）：
   这里我们是双系统，不需要格式化 windows 原有的 EFI 分区
   # mkfs.fat -F 32 <分区编号>
   ```

3. 连接 WIFI
查看无线网卡是否锁住或阻塞：
```
rfkill list
rfkill unblock wifi
rfkill unblock all
```
```
ip link
```
通过 `iwctl` 连接 WIFI
```
station wlan0 show
station wlan0 get-networks
tation wlan0 connect WIFI_NAME
```
4. 关闭 reflector，让系统不自动匹配安装源：
```
systemctl stop reflector
```
编辑安装源，只保留国内源就可以了：
```
vim /etc/pacman.d/mirrorlist
```
5.安装系统
```sh
pacman -Syy
pacman -S archlinux-keyring
pacstrap /mnt base base-devel linux-zen linux-firmware linux-zen-headers
genfstab -U /mnt >> /mnt/etc/fstab
```
6. 进入新系统
```sh
arch-chroot /mnt
```
7. 时区
```sh
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
date
```
8. 安装额外软件
```sh
pacman -S nano vim git tig grub os-prober efibootmgr noto-fonts-cjk noto-fonts-emoji amd-ucode（或 intel-ucode）
```
9. 本地化
编辑 `/etc/locale.gen`，取消这两行的注释：
```
en_US.UTF-8 UTF-8
zh_CN.UTF-8 UTF-8
```
```sh
locale-gen
```

编辑 `/etc/locale.conf`
```
LANG=en_US.UTF-8
```

编辑 `/etc/hostname`
```sh
arch
```

10. 用户
```sh
passwd
useradd -m -G wheel -s /bin/bash <USERNAME>
passwd <USERNAME>
```
编辑 `/etc/suders`，赋予ROOT权限：
```
%wheel ALL=(ALL:ALL) ALL
```

11. GRUB
编辑 `/etc/default/grub`，去掉这一行的注释：
```
GRUB_DISABLE_OS_PROBER=false
```

安装：
```sh
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB
grub-mkconfig -o /boot/grub/grub.cfg
```

12. 安装 KDE Plasma
```sh
pacman -S plasma-meta konsole dolphin kate
systemctl enable sddm
```

13. 蓝牙
```sh
sudo pacman -S bluez
sudo pacman -S bluez-utils
sudo systemctl start bluetooth.service
sudo systemctl enable bluetooth.service
```

## KDE 的使用
```
systemctl start NetworkManager
systemctl enable NetworkManager
```
## 软件
- Git, [Java](https://bell-sw.com/pages/downloads/#jdk-21-lts), Maven
- nodejs, npm, pnpm, yarn, nrm
   ```
   sudo pacman -S nodejs npm
   node -v
   npm -v
   
   npm get registry
   npm config set registry https://registry.npmmirror.com/
   
   sudo npm install -g pnpm
   pnpm get register
   pnpm config set registry https://registry.npmmirror.com
   
   sudo npm install -g yarn
   yarn config get registry
   yarn config set registry https://registry.npmmirror.com/
   
   sudo npm install nrm -g
   nrm list
   ```
- 编辑器
   ```sh
   # neovim
   yay neovim
   
   # zed
   curl -f https://zed.dev/install.sh | sh
   
   # code
   yay visual-studio-code-bin
   ```
- IDE: IDEA, PyCharm



### 魔法
```
yay v2ray v2raya
```
```
sudo systemctl start v2raya
sudo systemctl enable v2raya
```
